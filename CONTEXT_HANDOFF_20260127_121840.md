### CONTEXT HANDOFF — Sharmar — 2026-01-27

REPO / BRANCH
- Path: ~/Projects/sharmar
- Branch: main
- HEAD: ea036ff (pushed to origin/main)

LOCAL SERVICES
- Strapi: http://127.0.0.1:1337 (Docker: sharmar_strapi, Strapi 5.32.0)
- Postgres: Docker sharmar_pg (Postgres 16)
- Frontend dev: npm run dev → http://localhost:3000

WHAT WAS DONE (pushed)

1) Booking-request duplicates fixed (Strapi)
- cms/src/api/booking-request/content-types/booking-request/schema.json
  → draftAndPublish=false
- cms/src/api/booking-request/content-types/booking-request/lifecycles.ts
  → afterCreate dedup: if draft created and published sibling exists → delete draft
- IMPORTANT: Strapi runtime uses /dist → prod must run build so lifecycle compiles to dist.

2) Request API hardened + email infra (Frontend)
- frontend/app/lib/email.ts
  → resend = null if RESEND_API_KEY missing (warning only)
- frontend/app/lib/emailTemplates.ts
  → bookingAdminEmail()
- frontend/app/api/request/route.ts
  → email sent only if (BOOKING_TO && resend)
  → endpoint always returns ok even without email keys

3) HeaderMarinaFilter cleanup
- frontend/app/[lang]/HeaderMarinaFilter.tsx
  → removed hardcoded Strapi URL
  → uses fetchLocations(lang)
  → name normalized to string|null

DATA NOTES
- locations duplicated per locale in DB (66 rows = 22 slugs × 3 locales)
- correct usage is always querying with locale=en / ru / sr-Latn-ME
- boats API returns only published rows now

PROD SAFETY
- NO production deploy done yet
- all changes committed and pushed

NEXT TASKS (ORDER)
1) Design zero-downtime deploy (frontend + Strapi)
2) Verify prod Strapi build pipeline compiles lifecycle into dist
3) Add controlled lifecycle logging (only if needed)
4) Later: migrate Next images.domains → images.remotePatterns
